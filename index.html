<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Nano Wallet to Text</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css/style.css" />
</head>

<body>
  <div class="main">
    <div class="header">
      <h2>Convert Nano Wallet to UTF8 text and vice-versa</h2>
    </div>
    <div class="left">
      <h3>Text</h3>
      <textarea encode>minha frase de 32 caracteres ex.</textarea>
      <div class="optionInput">
        <strong>Newline at the end of each wallet?</strong>
        <br><input type="checkbox" id="newlineYes" name="newlineYes" />
        <label for="newlineYes">Yes, always</label>
        <input type="checkbox" id="newlineNo" name="newlineNo" checked="checked" />
        <label for="newlineNo">No, only with newline characters</label>
      </div>
    </div>

    <div class="center">
      <div class="s"><img src="https://png.pngtree.com/svg/20170116/exchange_1204779.png" /></div>
    </div>

    <div class="right">
      <h3>Nano Wallets (1 per line)</h3>
      <textarea decode></textarea>
      <div class="optionInput">
        <strong>Choose wallet prefix</strong>
        <br><input type="checkbox" id="nano_" name="nano" checked="checked" />
        <label for="nano_">nano_</label>
        <input type="checkbox" id="xrb_" name="xrb" />
        <label for="xrb_">xrb_</label>
      </div>
    </div>
    <hr>
    <div class="info">
      <p>Any character in UTF8 can be represented in base32 within a Nano wallet ... it's not just ASCII characters ... but a huge range of symbols and characters from different languages.</p>
      <p>Each wallet supports up to 32 bytes. Therefore, the maximum each wallet can store is 32 characters if each character occupies up to 1 byte. However, some special characters may occupy more than 1 byte. Examples:</p>
      <div class="example">abc...xyz ABC...XYZ 1234567890 , . ! ? ; @ ( ] = <strong>1 byte</strong></div>
      <div class="example">ç ã â í é ó ž ¼ ½ ¶ § ¤ ¥ ¢ ® ß æ Ё ϻ Є ϖ ϕ = <strong>2 bytes</strong></div>
      <div class="example">&#4613;  &#4625; &#4692; &#4986; &#11708; &#43820; 日 行 高 時 ⏁ ⏃ ⏈ ⏎ ⏳ = <strong>3 bytes</strong></div>
      <div class="example">𒇤 𒈂 𒈘 𒈙 𒐝 𒐫 = <strong>4 bytes</strong></div>
    </div>
    <footer class="footer">

      <div class="footer-about">
        <div class="poc">
              <img class="poc-icon" src="img/poc.png" style="height: 2em; width: 2em; display: block; fill: white;">
              Proof of Concept | Nano Wallet To Text
        </div>
          <ul class="about-list">
              <li>
                <a href="https://github.com/anarkrypto/NanoWalletToText" target="_blank">
            <svg role="img" aria-label="GitHub" focusable="false" style="height: 1.6em; width: 1.6em; display: block; fill: white;" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>
          </a>
        </li>

              <li>
                  <a href="https://www.facebook.com/groups/772120669873435/" target="_blank">
                      <i class="social-icon">
        <svg viewBox="0 0 32 32" role="img" aria-label="Facebook" focusable="false" style="height: 1.3em; width: 1.3em; display: block; fill: white;"><path d="m8 14.41v-4.17c0-.42.35-.81.77-.81h2.52v-2.08c0-4.84 2.48-7.31 7.42-7.35 1.65 0 3.22.21 4.69.64.46.14.63.42.6.88l-.56 4.06c-.04.18-.14.35-.32.53-.21.11-.42.18-.63.14-.88-.25-1.78-.35-2.8-.35-1.4 0-1.61.28-1.61 1.73v1.8h4.52c.42 0 .81.42.81.88l-.35 4.17c0 .42-.35.71-.77.71h-4.21v16c0 .42-.35.81-.77.81h-5.21c-.42 0-.8-.39-.8-.81v-16h-2.52a.78.78 0 0 1 -.78-.78" fill-rule="evenodd"></path></svg>
      </i>
                  </a>
              </li>
          </ul>
      </div>
  </footer>
  </div>


  <script src="js/nanotoutf8.js"></script>
  <script src="dist/utf8tonano.js"></script>
  <script>
  function concatTypedArrays(a, b) {
      var c = new (a.constructor)(a.length + b.length);
      c.set(a, 0);
      c.set(b, a.length);
      return c;
  }

  function removeAllElements(arrayBuffer, elem) {
      var typedArray = arrayBuffer, i;
      var index = typedArray.indexOf(elem)
      while (index > -1) {
        for ( i = index+1; i < typedArray.length; i+=1 ) {
            typedArray[i-1] = typedArray[i]
        }
        typedArray = new Uint8Array (typedArray.buffer.slice(0, typedArray.length-1))
        index = typedArray.indexOf(elem)
      }
      return typedArray
  }


  var newline = 0
  var prefix = "nano"
  var myChunkUint8array = new ArrayBuffer(32)

    encode = {"textarea": window.document.querySelector("textarea[encode]"), "output": window.document.querySelector("textarea[decode]")}
    encode.textarea.addEventListener("keyup", function(e){
      var input = e.target.value
      var uint8array = new TextEncoder("utf-8").encode(input);
      encode.output.value = ""
      for (bytecount=0; bytecount<uint8array.length; bytecount += 32){
        myChunkUint8array = uint8array.slice(bytecount, bytecount + 32)
        var address = utf8nano.fConvertFinalV2(myChunkUint8array, prefix);
        if (address) {
          encode.output.value += address + "\n"
        } else {
          encode.output.value += "\nError\n";
        }
      }
    })
    encode.textarea.dispatchEvent(new KeyboardEvent('keyup'));

    decode = {"textarea": window.document.querySelector("textarea[decode]"), "output": window.document.querySelector("textarea[encode]")}
    decode.textarea.addEventListener("keyup", function(e){


      var lines = e.target.value.split('\n');
      var output = new Uint8Array()
      decode.output.value = ""
      for(var i=0; i<lines.length; i++){
        var myText=lines[i]
        if (myText.length > 0) {
          var res = nanotoutf8(myText)
          if (res) {
            var output = concatTypedArrays(output, res)
            if (newline) output = concatTypedArrays(output, new TextEncoder("utf-8").encode('\n'))
          } else {
            decode.output.value += "\nError\n"
          }
        }
      }
      output = removeAllElements(output, 0)
      decode.output.value += new TextDecoder("utf-8").decode(output);
    })
      decode.textarea.dispatchEvent(new KeyboardEvent('keyup'));

      var checkboxNewline1 = document.querySelector("input[name=newlineYes]");
      var checkboxNewline2 = document.querySelector("input[name=newlineNo]");
      var checkboxPrefix1 = document.querySelector("input[name=nano]");
      var checkboxPrefix2 = document.querySelector("input[name=xrb]");

      checkboxNewline1.addEventListener('change', function() {
        if(this.checked) {
          newline = 1
          checkboxNewline2.checked = false;
        } else {
          newline = 0
          checkboxNewline2.checked = true;
        }
      });
      checkboxNewline2.addEventListener('change', function() {
        if(this.checked) {
          newline = 0
          checkboxNewline1.checked = false;
        } else {
          newline = 1
          checkboxNewline1.checked = true;
        }
      });

      checkboxPrefix1.addEventListener('change', function() {
        if(this.checked) {
          prefix = "nano"
          checkboxPrefix2.checked = false;
        } else {
          prefix = "xrb"
          checkboxPrefix2.checked = true;
        }
      });
      checkboxPrefix2.addEventListener('change', function() {
        if(this.checked) {
          prefix = "xrb"
          checkboxPrefix1.checked = false;
        } else {
          prefix = "nano"
          checkboxPrefix1.checked = true;
        }
      });

  </script>
</body>


</html>
